é€™æ˜¯ä¸€ä»½å°ˆç‚º **Windows æ‰“åŒ…èˆ‡ç™¼å¸ƒ (Packaging & Distribution)** è¨­è¨ˆçš„ 5 éšæ®µé–‹ç™¼è¨ˆåŠƒã€‚

é€™å€‹éç¨‹ä¸åªæ˜¯ã€Œè·‘ä¸€å€‹æŒ‡ä»¤ã€é‚£éº¼ç°¡å–®ï¼Œå®ƒæ¶‰åŠåˆ°è³‡æºæº–å‚™ã€è·¯å¾‘é…ç½®ã€ä»¥åŠç¢ºä¿ä½ çš„ Mocky æ‡‰ç”¨ç¨‹å¼åœ¨ã€Œè¢«æ‰“åŒ…ã€å¾Œï¼Œä¾ç„¶èƒ½æ­£ç¢ºè®€å–æœ¬åœ°è³‡æ–™åº« (`db.json`) å’Œéœæ…‹è³‡æº (å¦‚ Redoc HTML æ¨¡ç‰ˆ)ã€‚

---

### ğŸ“¦ Windows æ‰“åŒ…é–‹ç™¼è¨ˆåŠƒ (5 Stages)

#### Stage 1: è³‡æºæº–å‚™èˆ‡ç’°å¢ƒå»ºç½® (Assets & Environment)

**ç›®æ¨™**ï¼šæº–å‚™å¥½ Windows å°ˆç”¨çš„åœ–ç¤ºè³‡æºï¼Œä¸¦å®‰è£å¿…è¦çš„æ§‹å»ºå·¥å…·ã€‚

- **å¯¦ä½œæª”æ¡ˆ**:
- [x] `build/icon.png`: é«˜è§£æåº¦åŸå§‹æª” (è‡³å°‘ 1024x1024)ã€‚
- [x] `build/icon.ico`: Windows å°ˆç”¨åœ–ç¤º (åŒ…å« 256x256, 128x128 ç­‰å¤šå°ºå¯¸)ã€‚
- [x] `package.json`: æ–°å¢ `devDependencies`ã€‚

- **åŠŸèƒ½èˆ‡æ“ä½œ**:
- [x] ä½¿ç”¨ [ConvertICO](https://convertico.com/) æˆ– ImageMagick å°‡ PNG è½‰ç‚º ICOã€‚
- [x] åŸ·è¡Œ `pnpm install --save-dev electron-builder`ã€‚

- **é©—è­‰ Checklist**:
- [x] å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹å­˜åœ¨ `build/icon.ico` æª”æ¡ˆã€‚
- [x] `node_modules` ä¸­åŒ…å« `electron-builder`ã€‚
- [x] åŸ·è¡Œ `npx electron-builder --version` èƒ½æ­£ç¢ºé¡¯ç¤ºç‰ˆæœ¬è™Ÿã€‚

#### Stage 2: å»ºæ§‹é…ç½®èˆ‡è·¯å¾‘å°æ‡‰ (Configuration)

**ç›®æ¨™**ï¼šåœ¨ `package.json` ä¸­å‘Šè¨´æ‰“åŒ…å·¥å…·å¦‚ä½•è™•ç†ä½ çš„æª”æ¡ˆï¼Œé€™æ˜¯æœ€å®¹æ˜“å‡ºéŒ¯çš„åœ°æ–¹ã€‚

- **å¯¦ä½œæª”æ¡ˆ**:
- [x] `package.json`: æ–°å¢ `build` è¨­å®šå€å¡Š (ä½¿ç”¨ `electron-builder.yml` æ›¿ä»£)ã€‚

- **åŠŸèƒ½èˆ‡æ“ä½œ**:
- [x] è¨­å®š `appId`: `com.mocky.app` (å¿…é ˆå”¯ä¸€)ã€‚
- [x] è¨­å®š `directories.output`: `release` (æŒ‡å®šè¼¸å‡ºè³‡æ–™å¤¾)ã€‚
- [x] **é—œéµè¨­å®š `files**`: æ˜ç¢ºæŒ‡å®šè¦æ‰“åŒ…å“ªäº›è³‡æ–™å¤¾ã€‚
- `"out/**/*"` (Electron-Vite ç·¨è­¯å¾Œçš„æª”æ¡ˆ)
- `"package.json"`

- [x] **é—œéµè¨­å®š `extraResources**`: å¦‚æœä½ æœ‰ç”¨åˆ° `redoc.standalone.js`æˆ–é è¨­çš„`db.json` ç¯„æœ¬ï¼Œå¿…é ˆåœ¨æ­¤å®£å‘Šï¼Œå¦å‰‡æ‰“åŒ…å¾Œæœƒæ‰¾ä¸åˆ°æª”æ¡ˆã€‚

- **é©—è­‰ Checklist**:
- [x] `package.json` æ ¼å¼æ­£ç¢º (ç„¡ç´…è‰²èªæ³•éŒ¯èª¤)ã€‚
- [x] ç¢ºèª `main` æ¬„ä½æŒ‡å‘çš„æ˜¯ **ç·¨è­¯å¾Œ** çš„å…¥å£ (ä¾‹å¦‚ `out/main/index.js`)ï¼Œè€Œä¸æ˜¯ `.ts` åŸå§‹æª”ã€‚

#### Stage 3: é ç·¨è­¯èˆ‡æŒ‡ä»¤è…³æœ¬ (Pre-Build & Scripts)

**ç›®æ¨™**ï¼šç¢ºä¿åœ¨æ‰“åŒ…å‰ï¼Œæ‰€æœ‰ TypeScript ä»£ç¢¼éƒ½å·²æ­£ç¢ºç·¨è­¯ç‚º JavaScriptã€‚

- **å¯¦ä½œæª”æ¡ˆ**:
- [x] `package.json`: `scripts` å€å¡Šã€‚

- **åŠŸèƒ½èˆ‡æ“ä½œ**:
- [x] å®šç¾©æŒ‡ä»¤ `"build": "npm run typecheck && electron-vite build"`ã€‚
- [x] ç¢ºä¿ `electron-vite build` æœƒåŒæ™‚ç·¨è­¯ Renderer, Main, Preload Process åˆ° `out/` ç›®éŒ„ã€‚

- **é©—è­‰ Checklist**:
- [x] æ‰‹å‹•åŸ·è¡Œ `npm run build` (ä¸åŸ·è¡Œ electron-builder)ã€‚
- [x] æª¢æŸ¥å°ˆæ¡ˆç›®éŒ„ï¼Œç¢ºèª `out/renderer/index.html` å­˜åœ¨ä¸”æœ‰å…§å®¹ã€‚
- [x] æª¢æŸ¥ `out/main/` è³‡æ–™å¤¾ï¼Œç¢ºèª `index.js` (Main process) å­˜åœ¨ä¸”ä»£ç¢¼å·²è½‰è­¯ã€‚

#### Stage 4: è§£åŒ…æ¸¬è©¦ (Unpacked Verification)

**ç›®æ¨™**ï¼šç”¢ç”Ÿã€Œå…å®‰è£ç‰ˆã€çš„åŸ·è¡Œæª”ï¼Œå¿«é€Ÿé©—è­‰æ‰“åŒ…å¾Œçš„ç¨‹å¼é‚è¼¯æ˜¯å¦æ­£å¸¸ (é€™æ¯”æ¯æ¬¡éƒ½è·‘å®‰è£æª”å¿«å¾—å¤š)ã€‚

- **å¯¦ä½œæª”æ¡ˆ**:
- [x] `package.json`: èª¿æ•´ `win.target` åŠ å…¥ `"dir"` (è³‡æ–™å¤¾æ¨¡å¼) æˆ–ç›´æ¥åŸ·è¡ŒæŒ‡ä»¤åƒæ•¸ã€‚

- **åŠŸèƒ½èˆ‡æ“ä½œ**:
- [x] åŸ·è¡ŒæŒ‡ä»¤ï¼š`npx electron-builder --dir` (ä½¿ç”¨ `npm run build:unpack`)ã€‚
- [x] é€™æœƒç”¢ç”Ÿ `release/win-unpacked/` è³‡æ–™å¤¾ã€‚

- **é©—è­‰ Checklist**:
- [x] é€²å…¥ `release/win-unpacked/`ï¼Œé›™æ“Š `Mocky.exe`ã€‚
- [x] **æ ¸å¿ƒé©—è­‰**: App èƒ½é †åˆ©å•Ÿå‹•ï¼Œç„¡ç™½å± (White Screen of Death)ã€‚
- [x] **è³‡æ–™åº«é©—è­‰**: å»ºç«‹ä¸€å€‹æ–°å°ˆæ¡ˆï¼Œç¢ºèª `AppData/Roaming/Mocky/db.json` æœ‰è¢«æ­£ç¢ºå»ºç«‹ã€‚
- [x] **åœ–ç¤ºé©—è­‰**: å·¥ä½œåˆ— (Taskbar) é¡¯ç¤ºçš„æ˜¯ä½ çš„ Mocky Logoï¼Œè€Œä¸æ˜¯ Electron é è¨­åœ–ç¤ºã€‚

#### Stage 5: å®‰è£æª”è£½ä½œèˆ‡æœ€çµ‚é©—æ”¶ (Installer & E2E)

**ç›®æ¨™**ï¼šç”¢å‡ºæœ€çµ‚äº¤ä»˜çµ¦ä½¿ç”¨è€…çš„ `Setup.exe`ï¼Œä¸¦æ¸¬è©¦å®Œæ•´çš„å®‰è£/ç§»é™¤æµç¨‹ã€‚

- **å¯¦ä½œæª”æ¡ˆ**:
- [x] `package.json`: `nsis` è¨­å®šå€å¡Š (ä¸€éµå®‰è£ vs è¼”åŠ©å®‰è£) - å·²åœ¨ `electron-builder.yml` ä¸­è¨­å®šã€‚

- **åŠŸèƒ½èˆ‡æ“ä½œ**:
- [x] è¨­å®š NSIS é¸é …ï¼š
- `oneClick: false` (å…è¨±ä½¿ç”¨è€…é¸è·¯å¾‘)ã€‚
- `allowToChangeInstallationDirectory: true`ã€‚
- `createDesktopShortcut: true`ã€‚

- [x] åŸ·è¡Œå®Œæ•´æ‰“åŒ…æŒ‡ä»¤ï¼š`npm run build:win` (ä½¿ç”¨ `npm run electron:build` çš„åˆ¥å)ã€‚

- **é©—è­‰ Checklist**:
- [x] `release/` è³‡æ–™å¤¾ä¸­å‡ºç¾ `mocky-1.0.0-setup.exe`ã€‚
- [x] **å®‰è£æ¸¬è©¦**: åŸ·è¡Œå®‰è£æª”ï¼Œæµç¨‹é †æš¢ï¼Œä¸”èƒ½é¸æ“‡å®‰è£è·¯å¾‘ã€‚
- [x] **æ·å¾‘æ¸¬è©¦**: æ¡Œé¢å’Œé–‹å§‹é¸å–®æ­£ç¢ºå‡ºç¾ Mockyæ·å¾‘ã€‚
- [x] **ç§»é™¤æ¸¬è©¦**: åˆ° Windowsã€Œè¨­å®šã€->ã€Œæ‡‰ç”¨ç¨‹å¼ã€åŸ·è¡Œç§»é™¤ï¼Œç¢ºèªæ‡‰ç”¨ç¨‹å¼è¢«ä¹¾æ·¨ç§»é™¤ã€‚
- [x] **é˜²ç«ç‰†æ¸¬è©¦**: å•Ÿå‹• Mock Server (Port 8000) æ™‚ï¼ŒWindows é˜²ç«ç‰†å¯èƒ½æœƒè·³å‡ºè©¢å•ï¼Œç¢ºèªé»æ“Šã€Œå…è¨±ã€å¾Œå¤–éƒ¨è¨­å‚™ (å¦‚æ‰‹æ©Ÿ) èƒ½é€éå€åŸŸç¶²è·¯é€£ä¸Š Mock Server (é¸ç”¨æ¸¬è©¦)ã€‚

---

### ğŸ’¡ é–‹ç™¼è€…å°æé†’ï¼šè·¯å¾‘å•é¡Œ (Path Issues)

åœ¨æ‰“åŒ…å¾Œï¼Œæœ€å¸¸é‡åˆ°çš„ Bug æ˜¯ **ã€Œæ‰¾ä¸åˆ°æª”æ¡ˆã€**ã€‚é€™æ˜¯å› ç‚ºé–‹ç™¼ç’°å¢ƒ (`src/`) å’Œæ‰“åŒ…ç’°å¢ƒ (`resources/app.asar/`) çš„è·¯å¾‘çµæ§‹ä¸åŒã€‚

- **é–‹ç™¼æ™‚**: ä½¿ç”¨ `path.join(__dirname, '../assets/icon.png')` å¯èƒ½æ²’å•é¡Œã€‚
- **æ‰“åŒ…å¾Œ**: `__dirname` å¯èƒ½æœƒè®Šï¼Œæˆ–è€…æª”æ¡ˆè¢«åŒ…é€² `app.asar` é€™å€‹è™›æ“¬å£“ç¸®æª”è£¡ï¼Œå°è‡´ `fs.readFile` è®€ä¸åˆ°ã€‚

**è§£æ±ºæ–¹æ¡ˆ**:
åœ¨ Main Process ä¸­ï¼Œå»ºè­°ä½¿ç”¨ä»¥ä¸‹ helper å‡½æ•¸ä¾†è™•ç†è·¯å¾‘ï¼Œç¢ºä¿é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒéƒ½èƒ½é‹ä½œï¼š

```javascript
import { app } from 'electron'
import path from 'path'

const isDev = !app.isPackaged

function getAssetPath(fileName) {
  if (isDev) {
    return path.join(__dirname, '../../public', fileName) // è¦–ä½ çš„ç›®éŒ„çµæ§‹èª¿æ•´
  }
  // æ‰“åŒ…å¾Œï¼ŒextraResources æœƒå°‡æª”æ¡ˆæ”¾åœ¨ resources è³‡æ–™å¤¾
  return path.join(process.resourcesPath, fileName)
}
```
